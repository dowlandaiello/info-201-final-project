---
title: "Analysis: Google Search Interest in Immigration-Related Topics vs Electoral Swing Per County"
author: "Dowland Aiello, Roy Lin, Winston Qi"
date: "2025-06-08"
output: html_document
---

```{r setup ,include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 1. Overview

Herein, we explore the relationship between google search query frequency for topics related to immigration and the electoral swing in the Presidential election at a given point in time. We are particularly interested in the relationship between the change in search frequency and the magnitude of the electoral swinng.

## 2. Data Cleaning

See the `scripts/` folder for utilities we wrote to clean our data. Notably, Google trends data for city / region over varying time frames were combined from multiple CSV files into a single table, which looks like this:

```{r}
library(dplyr)
library(purrr)
library(tidyr)
library(stringr)

trendsdf <- read.csv("../../data_cleaned/google_trends/summarized.csv")
trendsdf %>% head(5)
```

## 3. Electoral Swing from 2004 - 2008 Presidential Elections

### 3.1 Data Overview

Here is an overview of the electiondf dataset:

```{r}
electiondf <- read.csv("../../data_cleaned/harvard_election/countypres_2000-2020.csv")
electiondf %>% sample_n(10)
```

### 3.2 Data Cleaning

For this particular analysis, we are interested in the swing from 2004 to 2008. We can get all data from these date ranges like such:

```{r}
electiondf %>%
    filter(year == 2004 | year == 2008) %>%
    sample_n(5)
```

We can gather all votes in 2004 and 2008 per county via the pivot function:

```{r}
votestimeframe <- electiondf %>%
  # Only interested in vote counts for 2004 or 2008
  filter(year == 2004 | year == 2008) %>%
  select(year, state, county_name, party, office, candidatevotes) %>%
  # Only get rows where the candidates won
  group_by(year, state, county_name, office) %>%
  filter(candidatevotes == max(candidatevotes)) %>%
  ungroup %>%
  # Collapse votes in 2004 and 2008 into columns 2004 and 2008
  group_by(state, county_name, office) %>%
  pivot_wider(id_cols = c(state, county_name, party, office), names_from = year, values_from = candidatevotes)

votestimeframe %>% head(10)
```

### 3.3 Swing Calculation

We can then calculate the swing like such:

```{r}
votestimeframe %>%
    group_by(state, county_name, office) %>%
    summarise(swing = .data[["2008"]] - .data[["2004"]]) %>%
    head(10)
```

### 3.4 Generalization to a Function

We define a function `swing_timeframe` which performs the above steps. We also normalize the swing as a change in percentage basis points:

```{r}
swing_timeframe <- function(year1, year2) {
  read.csv(c("../../data_cleaned/harvard_election/countypres_", year1, "-", year2, ".csv")) %>%
    filter(year == year1 | year == year2) %>%
    select(year, state, county_name, party, office, candidatevotes, totalvotes) %>%
    # Only get rows where the candidates won
    group_by(year, state, county_name, office) %>%
    filter(candidatevotes == max(candidatevotes)) %>%
    ungroup %>%
    # Collapse votes in 2004 and 2008 into columns 2004 and 2008
    group_by(state, county_name, office) %>%
    pivot_wider(id_cols = c(state, county_name, party, office), names_from = year, values_from = c(candidatevotes, totalvotes)) %>%
    group_by(state, county_name, office) %>%
    summarise(swing = .data[["2008_candidatevotes"]] / .data[["2008_totalvotes"]] - (.data[["2004_candidatevotes"]] / .data[["2008_totalvotes"]]))
}
```
